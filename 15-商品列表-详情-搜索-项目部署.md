在 navbar 中，渠道 /stores/home 中的 counter，并展示。

---

首页

轮播图

安装 ant-design 框架，和它的类型。

优先参考[官方文档](https://ant.design/docs/react/use-with-next-cn)

```shell
npm install antd

npm install -D @types/antd
```

在 _app.tsx 中，导入 antd 的统一样式风格。

src\pages\_app.tsx

```tsx
import "antd/dist/reset.css";
```

在 index.tsx 中，导入 antd 的按钮组件。

src\pages\index.tsx

```tsx
import { Button } from 'antd';
```

antd 默认支持 tree shaking。

---

创建 /components/top-swiper.tsx 组件

在其中，导入 antd 的 carousel 组件。

src\components\top-swiper\index.tsx

```tsx
import React, { memo } from 'react'
import type { FC, ReactNode } from 'react'
import styles from './index.module.scss';
import classNames from 'classnames';
import { Carousel } from 'antd';

const contentStyle: React.CSSProperties = {
  margin: 0,
  height: '160px',
  color: '#fff',
  lineHeight: '160px',
  textAlign: 'center',
  background: '#364d79',
};

interface IProps {
  children?: ReactNode
}
const TopSwiper: FC<IProps> = memo(props => {
  const onChange = (currentSlide: number) => {
    console.log(currentSlide);
  };
  
  return <div>
    <div className={classNames('wrapper', styles['content'])}>
    <Carousel afterChange={onChange}>
      <div>
        <h3 style={contentStyle}>1</h3>
      </div>
      <div>
        <h3 style={contentStyle}>2</h3>
      </div>
      <div>
        <h3 style={contentStyle}>3</h3>
      </div>
      <div>
        <h3 style={contentStyle}>4</h3>
      </div>
    </Carousel>
    </div>
  </div>
})

TopSwiper.displayName = 'TopSwiper'

export default TopSwiper
```

在首页 index.tsx 中，引入 top-swiper 组件

src\pages\index.tsx

```tsx
import wrapper from '@/stores'
import { fetchSearchSuggest } from '@/stores/features/home'
import type { GetServerSideProps } from 'next'
import { Inter } from 'next/font/google'
import TopSwiper from '@/components/top-swiper'
import styles from './index.module.scss'

const inter = Inter({ subsets: ['latin'] })

export default function Home() {
  return (
    <>
      <div className={styles.home}>
        <TopSwiper></TopSwiper>
      </div>
    </>
  )
}

export const getServerSideProps: GetServerSideProps = wrapper.getServerSideProps(function (store) {
  return async function (context) {
    // 派发异步 action 来发起请求，拿到搜索建议，并存到 redux 中
    await store.dispatch(fetchSearchSuggest())

    return {
      props: {}
    }
  }
})
```

---

封装网络请求，获取轮播图的数据。

src\service\features\home.ts

```typescript
export const getHomeInfo = () =>
  ztRequest.get<IResultData<HomeInfo>>({
    url: '/home/info'
  })
```

在首页 index.tsx 中的 getServerSideProps 中，发送网络请求。

获取到 banners 的数据，并传递给 top-swiper

src\pages\index.tsx

```typescript
import wrapper from '@/stores'
import { fetchSearchSuggest } from '@/stores/features/home'
import type { GetServerSideProps } from 'next'
import TopSwiper from '@/components/top-swiper'
import styles from './index.module.scss'
import { type FC, memo } from 'react'
import type { Banner, Category, Recommend, DigitalData } from '@/types/home';
import { getHomeInfo } from '@/service/features/home'

interface IProps {
  banners: Banner[]
}
const Home: FC<IProps> = memo((props) => {
  const { banners } = props;

  return (
    <>
      <div className={styles.home}>
        <TopSwiper banners={banners}></TopSwiper>
      </div>
    </>
  )
})

Home.displayName = 'Home'
export default Home

export const getServerSideProps: GetServerSideProps = wrapper.getServerSideProps(function (store) {
  return async function (context) {
    // 派发异步 action 来发起请求，拿到搜索建议，并存到 redux 中
    await store.dispatch(fetchSearchSuggest())

    const res = await getHomeInfo()
    return {
      props: {
        banners: res.data.banners
      }
    }
  }
})
```

在 top-swiper 中，展示图片：

为 carousel 组件，设置属性。

为轮播图，添加背景。

- 将轮播图放大，但图片的宽、高不变（在 carousel 样式中体现）。

在其中编写指示器，和操作按钮。

src\components\top-swiper\index.tsx

```tsx
import React, { memo, useRef, useState } from 'react'
import type { ElementRef, FC, ReactNode } from 'react'
import styles from './index.module.scss'
import classNames from 'classnames'
import { Carousel } from 'antd'
// import type { Banner, Category, Recommend, DigitalData } from '@/types/home'
import type { Banner } from '@/types/home'
import Image from 'next/image'

interface IProps {
  children?: ReactNode
  banners: Banner[]
}
const TopSwiper: FC<IProps> = memo(props => {
  const { banners } = props

  // 状态
  const [currentIndex, setCurrentIndex] = useState(0);

  // ref
  const bannerRef = useRef<ElementRef<typeof Carousel>>(null)

  // 事件处理：轮播图滚动
  const onSwiperChange = (currentSlide: number) => {
    setCurrentIndex(currentSlide)
  }

  // 事件处理：轮播图操作上一屏点击
  const onPrevPage = () => {
    bannerRef.current?.prev();
  }
  
  // 事件处理：轮播图操作下一屏点击
  const onNextPage = () => {
    bannerRef.current?.next();
  }

  return (
    <div className={styles['top-swiper']}>
      {/* 轮播图  */}
      <div className={classNames('wrapper', styles['content'])}>
        <Carousel
          ref={bannerRef}
          className={styles['carousel']}
          autoplay
          autoplaySpeed={3000}
          fade
          dots={false}
          afterChange={onSwiperChange}
        >
          {banners.map(item => (
            <div className={styles['swiper-item']} key={item.id}>
              {/* 背景 */}
              <div
                className={styles['swiper-bg']}
                style={{
                  backgroundImage: `url(${item.backendPicStr})`
                }}
              ></div>

              <Image
                className={styles['image']}
                src={item.picStr}
                alt="banner"
                width={1100}
                height={400}
                priority
              ></Image>
            </div>
          ))}
        </Carousel>

        {/* 指示器 */}
        <ul className={styles['dots']}>
          {banners?.map((item, index) => (
            <li
              key={item.id}
              className={classNames(styles['dot'], currentIndex === index ? styles.active : '')}
            ></li>
          ))}
        </ul>
      </div>

      {/* 操作按钮（上一张/下一张） */}
      <button className={styles['prev']} onClick={onPrevPage}>
        <span></span>
      </button>
      <button className={styles['next']} onClick={onNextPage}>
        <span></span>
      </button>
    </div>
  )
})

TopSwiper.displayName = 'TopSwiper'

export default TopSwiper

```

在 next.config.js 中，配置网络图片域名白名单：

next.config.js

```typescript
/** @type {import('next').NextConfig} */
const nextConfig = {
  reactStrictMode: true,
  images: {
    remotePatterns: [
      {
        protocol: 'https',
        hostname: '**.music.126.net'
      },
      {
        protocol: 'http',
        hostname: '**.music.126.net'
      }
    ]
  }
}

module.exports = nextConfig
```

---

创建 /components/tab-category/index.tsx 嘴贱

src\components\tab-category\index.tsx

```tsx
import React, { memo } from 'react'
import type { FC, ReactNode } from 'react'
import styles from './index.module.scss'
import classNames from 'classnames'

interface IProps {
  children?: ReactNode
}
const TabCategory: FC<IProps> = memo(props => {
  return (
    <div className={styles['tab-category']}>
      <div className={classNames('wrapper', styles['content'])}>TabCategory</div>
    </div>
  )
})

TabCategory.displayName = 'TabCategory'

export default TabCategory
```

在首页 index.tsx 中，传递 category 数据。

在 tab-category 中，接收 category 数据。使用 antd 的栅格系统组件。

src\components\tab-category\index.tsx

```tsx
import React, { memo } from 'react'
import type { FC, ReactNode } from 'react'
import styles from './index.module.scss'
import classNames from 'classnames'
import type { Category } from '@/types/home'
import { Col, Row } from 'antd'
import Image from 'next/image'

interface IProps {
  children?: ReactNode
  categorys: Category[]
}
const TabCategory: FC<IProps> = memo(props => {
  const { categorys } = props

  return (
    <div className={styles['tab-category']}>
      <div className={classNames('wrapper', styles['content'])}>
        <Row>
          {categorys.map(item => (
            <Col span={6} key={item.cid}>
              <div className={styles['category-item']}>
                <Image
                  className={styles['image']}
                  src={item.picStr!}
                  alt="category"
                  width={48}
                  height={48}
                ></Image>

                <div className={styles['right']}>
                  <div className={styles['title']}>{item.title}</div>
                  {/* 描述 type == 1 才会显示*/}
                  {item.type === 1 && (
                    <div className={styles['sub-title']}>
                      <span className={styles['count']}>{item.count}</span>
                      <span className={styles['desc']}>{item.desc}</span>
                    </div>
                  )}
                </div>
              </div>
            </Col>
          ))}
        </Row>
      </div>
    </div>
  )
})

TabCategory.displayName = 'TabCategory'

export default TabCategory
```

---

创建 /components/recommend/index.tsx 组件。

在 index.tsx 中，使用该组件。

src\components\recommend\index.tsx

```tsx
import React, { memo } from 'react'
import type { FC, ReactNode } from 'react'
import styles from './index.module.scss'
import classNames from 'classnames'

interface IProps {
  children?: ReactNode
}
const Recommend: FC<IProps> = memo(props => {
  return (
    <div className={styles['recommend']}>
      <div className={classNames('wrapper', styles['content'])}>Recommend</div>
    </div>
  )
})

Recommend.displayName = 'Recommend'

export default Recommend
```

在首页 index.tsx 中，传递 Recommend 数据。

在 Recommend 中，接收 recommend 数据。使用 antd 的栅格系统 Rol、Col 组件。

src\components\recommend\index.tsx

```tsx
import React, { memo } from 'react'
import type { FC, ReactNode } from 'react'
import styles from './index.module.scss'
import classNames from 'classnames'
import type { Recommend } from '@/types/home'
import { Col, Row } from 'antd'
import Image from 'next/image'
import Link from 'next/link'

interface IProps {
  children?: ReactNode
  recommends: Recommend[]
}
const Recommend: FC<IProps> = memo(props => {
  const { recommends } = props

  return (
    <div className={styles['recommend']}>
      <div className={classNames('wrapper', styles['content'])}>
        <Row>
          {recommends.map(item => (
            <Col key={item.id} span={12}>
              <Link href={'/detail?id=' + item.id} className={styles['recommend-item']}>
                <Image
                  className={styles.image}
                  src={item.picStr!}
                  alt="recommend"
                  width={542}
                  height={300}
                ></Image>
              </Link>
            </Col>
          ))}
        </Row>
      </div>
    </div>
  )
})

Recommend.displayName = 'Recommend'

export default Recommend
```

---

编写商品区域。

编写商品标题组件

创建 /components/section-title/index.tsx 组件，用于商品区域标题的封装。

在其中接收 title 属性。

src\components\section-title\index.tsx

```tsx
import React, { memo } from 'react'
import type { FC, ReactNode } from 'react'
import styles from './index.module.scss'

interface IProps {
  children?: ReactNode
  title: string
}
const SectionTitle: FC<IProps> = memo(props => {
  const { title } = props

  return <div className={styles['section-title']}>{title}</div>
})

SectionTitle.displayName = 'SectionTitle'

export default SectionTitle
```

在 index.tsx 中，使用

src\pages\index.tsx

```tsx
{/* 商品区域 */}
<div className={classNames('wrapper', styles['content'])}>
  <SectionTitle title="商品推荐"></SectionTitle>
</div>
```

---

封装网络请求，获取商品数据。

src\service\features\home.ts

```typescript
export const getProductInfo = () =>
  ztRequest.get<IResultData<ProductInfo>>({
    url: '/hotproduct_v2/gets'
  })
```

在 index.tsx 中，发送网络请求：

src\pages\index.tsx

```typescript
interface IProps {
  banners: Banner[]
  categorys: Category[]
  recommends: Recommend[]
  hotProducts: HotProduct[]
}
const Home: FC<IProps> = memo(props => {
  const { banners, categorys, recommends, hotProducts } = props

  //...
})

export const getServerSideProps: GetServerSideProps = wrapper.getServerSideProps(function (store) {
  return async function (context) {
    // 1.派发异步 action 来发起请求，拿到搜索建议，并存到 redux 中
    await store.dispatch(fetchSearchSuggest())

    // 2.发送网络请求，获取主页信息。
    // 3.发送网络请求，获取商品数据
    const [homeinfo, productinfo] = await Promise.all([getHomeInfo(), getProductInfo()])
    return {
      props: {
        banners: homeinfo.data.banners,
        categorys: homeinfo.data.categorys,
        recommends: homeinfo.data.recommends,
        hotProducts: productinfo.data.hotProduct,
      }
    }
  }
})
```

---

编写商品区域组件

创建 /components/grid-view/index.tsx 组件，用于展示商品区域。

src\components\grid-view\index.tsx

```tsx
import React, { memo } from 'react'
import type { FC, ReactNode } from 'react'

interface IProps {
  children?: ReactNode
}
const GridView: FC<IProps> = memo(props => {
  return <div className={'grid-view'}>
    GridView
  </div>
})

GridView.displayName = 'GridView'

export default GridView
```

在 index.tsx 中，使用 grid-view 组件。将 product 数据，传递给它

在 grid-view 中，接收 products 商品数据。在其中使用 antd 的栅栏组件 Rol，Col。

