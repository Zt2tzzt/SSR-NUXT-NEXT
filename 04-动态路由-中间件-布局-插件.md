动态路由

[] 方括号语法。方括号中的内容，是参数。

创建 detail01 页面

```shell
npx nuxi add page detail01/index
```

demo-project\03-hello-nuxt\app.vue

```vue
<NuxtLink to="/detail01">
  <button>detail01</button>
</NuxtLink>
```



创建 detail02 页面，用于测试动态路由。

动态路由和普通路由可以共存。

```shell
npx nuxi add page detail02/index

npx nuxi add page detail02/[id]
```

demo-project\03-hello-nuxt\app.vue

```vue
<NuxtLink to="/detail02">
  <button>detail02</button>
</NuxtLink>
<NuxtLink to="/detail02/233">
  <button>detail02/id</button>
</NuxtLink>
```

demo-project\03-hello-nuxt\pages\detail02\[id].vue

```vue
<script lang="ts" setup>
const route = useRoute()
const id = route.params.id
</script>

<template>
  <div>
    Page: detail02/{{ id }}
  </div>
</template>
```





新建 detail03 页面，测试 [] 前面有字符串，是否还可以使用。

```shell
npx nuxi add page detail03/user-[id]
```

demo-project\03-hello-nuxt\app.vue

```vue
<NuxtLink to="/detail03/user-666">
  <button>detail03/user-id</button>
</NuxtLink>
```

demo-project\03-hello-nuxt\pages\detail03\user-[id].vue

```vue
<script lang="ts" setup>
const route = useRoute()
const { id } = route.params;
</script>

<template>
  <div>
    Page: detail03/user-{{ id }}
  </div>
</template>
```



创建 detail04-[role] 页面，测试目录前面有 [] 的情况。

```shell
npx nuxi add page detail04-[role]/index
```

demo-project\03-hello-nuxt\app.vue

```vue
<NuxtLink to="/detail04-admin">
  <button>detail04-admin</button>
</NuxtLink>
```

demo-project\03-hello-nuxt\pages\detail04-[role]\index.vue

```vue
<script lang="ts" setup>
const route = useRoute()
const { role } = route.params;
</script>

<template>
  <div>
    Page: detail04-{{ role }}
  </div>
</template>
```

在 detail04-[role] 下，新建 [id].vue

在 app.vue 中，添加对应的路由。

demo-project\03-hello-nuxt\app.vue

```vue
<NuxtLink to="/detail04-admin/233">
  <button>detail04-admin/233</button>
</NuxtLink>
```

demo-project\03-hello-nuxt\pages\detail04-[role]\[id].vue

```vue
<script lang="ts" setup>
const route = useRoute()
const { role, id } = route.params;
</script>

<template>
  <div>
    Page: detail04-{{ role }}/{{ id }}
  </div>
</template>
```



获取查询字符串的参数。

demo-project\03-hello-nuxt\app.vue

```vue
<NuxtLink to="/detail01?name=zzt">
  <button>detail01?mame=zzt</button>
</NuxtLink>
```

demo-project\03-hello-nuxt\pages\detail01\index.vue

```vue
<script lang="ts" setup>
const route = useRoute()
const { name } = route.query;
</script>

<template>
  <div>
    Page: detail01?name={{ name }}
  </div>
</template>
```



404 page

创建 detail05 页面。

```shell
npx nuxi add page detail05/index
```

创建一个 [...slug].vue 文件，用于捕获 detail05 路由中，不存在的路径。

demo-project\03-hello-nuxt\pages\detail05\[...slug].vue

```vue
<script lang="ts" setup></script>

<template>
  <div>
    Page: detail05 404 not find page
  </div>
</template>

<style scoped></style>
```

demo-project\03-hello-nuxt\app.vue

```vue
<NuxtLink to="/detail05">
  <button>detail05</button>
</NuxtLink>
```

如果想要捕获全局的 404 page。

在 pages 目录下，创建 [...slug].vue 文件。

```shell
npx nuxi add page [...slug].vue
```

在其中，解构 slug，获取路径。

demo-project\03-hello-nuxt\pages\[...slug].vue

```vue
<script lang="ts" setup>
const route = useRoute()
const { slug } = route.params;
</script>

<template>
  <div>
    Page: 404 Not Found page
    slug: {{ slug }}
  </div>
</template>

<style scoped></style>
```

> slug 这个名字不是固定的，只是官网中推荐这么写。

---

路由的匹配规则总结。

---

嵌套路由。

步骤：



在 pages 目录下，创建一个 parent.vue 页面

```shell
npx nuxi add page parent.vue
```

创建 parent 目录，在其中新建 index.vue，child1.vue，child2.vue 页面。

其中 index》vue 是二级路由默认页面。

在 parent.vue 中，添加路由连接，路由占位：

demo-project\03-hello-nuxt\pages\parent.vue

```vue
<script lang="ts" setup></script>

<template>
  <div>
    Page: Parent
    <div></div>
    <!-- 路由连接 -->
    <NuxtLink to="/parent">
      <button>default</button>
    </NuxtLink>
    <NuxtLink to="/parent/child1">
      <button>child1</button>
    </NuxtLink>
    <NuxtLink to="/parent/child2">
      <button>child2</button>
    </NuxtLink>

    <!-- 添加路由占位 -->
    <NuxtPage></NuxtPage>
  </div>
</template>

<style scoped></style>
```

---

路由中间件。

什么是路由的中间件？

router.beforeEach((from, to) => {}) 也可用于监听。

> 中间件，本质就是函数

有哪三种？



匿名中间件：

在 pages/index.vue 中，编写中间件。

- 只有在切换到 index.vue 页面时，路由才会执行。

demo-project\03-hello-nuxt\pages\index.vue

```vue
<script setup lang="ts">
definePageMeta({
  // 路由中间件（监听路由）
  middleware: [
    function (to, from) {
      console.log('middleware to:', to)
      console.log('middleware from:', from)
    }
  ]
})
</script>
```

在中间件中，返回一个 '', null, undefind，会继续执行下一个中间件。

返回一个 navigateTo('detail02')，会跳转到 detail02 页面。

返回一个 abordNavigation('终止导航')，会终止。

demo-project\03-hello-nuxt\pages\index.vue

```vue
<script setup lang="ts">
definePageMeta({
  // 路由中间件（监听路由）
  middleware: [
    function (to, from) {
      console.log('执行中间件1~')
      //  return navigateTo('/detail02')
      return abortNavigation('终止导航')
    },
    function (to, from) {
      console.log('执行中间件2~')
    }
  ]
})
</script>
```



命名路由中间件：

在根目录，创建 middleware 目录，

在其中创建 home.ts

demo-project\03-hello-nuxt\middleware\home.ts

```typescript
export default defineNuxtRouteMiddleware((to, from) => {
  console.log('home.ts 执行中间件2~')
})
```

demo-project\03-hello-nuxt\pages\index.vue

```vue
<script setup lang="ts">
definePageMeta({
  // 路由中间件（监听路由）
  middleware: [
    function (to, from) {
      console.log('执行中间件1~')
      //  return navigateTo('/detail02')
      // return abortNavigation('终止导航')
    },
    // 命名中间件
    'home',
    function (to, from) {
      console.log('执行中间件3~')
    }
  ]
})
</script>
```

> 中间件在客户端一定会执行，在服务端，只有刷新页面时，会执行。



全局路由中间件。

编写一个中间件，专门用来判断用户是否已经登陆。

在 middleware 目录下，创建 auth.global.ts

demo-project\03-hello-nuxt\middleware\auth.global.ts

```typescript
export default defineNuxtRouteMiddleware((to, from) => {
  console.log('auth.ts 执行中间件4~')
  const isLogin = false
  if (isLogin) {
    return navigateTo('/login')
  }
})
```

全局切换路由，都会执行该中间件。



路由验证。

验证路由 /detail02/[id] 中，id 为数字类型。

demo-project\03-hello-nuxt\pages\detail02\[id].vue

```vue
<script lang="ts" setup>
const route = useRoute()
const id = route.params.id

definePageMeta({
  validate: (route) => {
    return /^\d+$/.test(route.params.id as string)
  }
})
</script>
```

在 validate 方法中，返回错误码。

demo-project\03-hello-nuxt\pages\detail02\[id].vue

```vue
<script lang="ts" setup>
const route = useRoute()
const id = route.params.id

definePageMeta({
  validate: (route) => {
    // return /^\d+$/.test(route.params.id as string)

    return {
      statusCode: 401,
      statusMessage: 'validate router error'
    }
  }
})
</script>
```

错误处理，自定义报错页面。

在项目根目录下，新建 error.vue 页面。

demo-project\03-hello-nuxt\error.vue

```vue
<script lang="ts" setup>
defineProps({
  error: Object
})

// 会首页
function onGoHomeclick() {
  // 清空错误信息，再跳转
  clearError({ redirect: '/' })
}
</script>

<template>
  <div>
    Page error {{ error }}
  </div>
  <div>
    <button @click="onGoHomeclick">go Home</button>
  </div>
</template>

<style scoped></style>
```

---

布局（Layout）



创建 profile.vue 页面

在项目根目录，创建 layouts 目录，在其中，创建 default.vue

demo-project\03-hello-nuxt\layout\default.vue

```vue
<script setup lang="ts">
</script>

<template>
  <div class="layout-default">
    <div class="header">我是 header</div>
    <slot></slot>
    <div class="footer">我是 footer</div>
  </div>
</template>

<style scoped lang="less">
.header {
  border: 1px solid red;
  text-align: center;
  line-height: 80px;
  background-color: red;
}

.header {
  border: 1px solid green;
  text-align: center;
  line-height: 80px;
  background-color: #cdcdcd;
}
</style>
```

在 app.vue 中，使用布局

demo-project\03-hello-nuxt\app.vue

```vue
<!-- 会自动加载默认布局：/layout/default.vue -->
<NuxtLayout>
  <NuxtPage></NuxtPage>
</NuxtLayout>
```



自定义布局：

创建 layouts/custom-layout.vue

demo-project\03-hello-nuxt\layouts\custome-layout.vue

```vue
<template>
  <div class="custom-layout">
    <slot></slot>
  </div>
</template>
```

创建 login.vue 页面，只有

demo-project\03-hello-nuxt\pages\login.vue

```vue
<script lang="ts" setup>
definePageMeta({
  layout: 'custome-layout'
})
</script>

<template>
  <div>
    Page: Login
  </div>
</template>

<style scoped></style>
```

---

渲染模式

demo-project\03-hello-nuxt\nuxt.config.ts

```typescript
export default defineNuxtConfig({
  routeRules: {
    '/': { ssr: true },
    'category': { ssr: false }, // spa 应用
    // 混合渲染，实验性特性
    '/cart': { static: true }, // 只会在构建时，生成一次静态页面。
    // '/profile': { swr: true } // 会生成多次静态页面，自动验证页面需要重新生成时，生成页面。
    '/profile': { swr: 60 * 10 } // 10 分钟后检测。
  }
})
```

---

Nuxt 插件



方式一：使用 useNuxtApp 创建插件：

编写一个时间格式化的插件：

在 app.vue 中，安装插件，并使用插件。

支持注册函数，对象，字符串。

demo-project\03-hello-nuxt\app.vue

```vue
<script setup lang="ts">
// 编写插件
const nuxtApp = useNuxtApp()
nuxtApp.provide('formatData', () => {
  return '2023-06-11'
})
nuxtApp.provide('version', 'v1.0.0')

console.log('formatData:', nuxtApp.$formatData())
console.log('version:', nuxtApp.$version)
</script>
```



方式二：

创建 plugins 目录，在其中创建 price.client.ts 文件，表示只会在客户端中，使用的插件

demo-project\03-hello-nuxt\plugins\price.ts

```typescript
export default defineNuxtPlugin((nuxtApp) => {
  return {
    provide: {
      // 自定义插件，格式化价格，在创建 vue 实例时，就会注册好。
      formatPrice: (price: number) => {
        return price.toFixed(2)
      }
    }
  }
})
```

demo-project\03-hello-nuxt\app.vue

```typescript
const nuxtApp = useNuxtApp()

if (process.client)  {
  console.log('formatPrice:', nuxtApp.$formatPrice(100.875638))
}
```

